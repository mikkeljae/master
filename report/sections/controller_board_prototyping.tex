%!TEX root = ../main.tex
\subsection{Prototyping}
\label{sub:controller_board_prototyping}
Something clever about why we made prototypes.


\subsubsection{Testing the Power Board}
It was decided to test the power board before ordering it from a professional PCB manufacturer.
In order to test it a home-made PCB was made at the University's PCB lab.

Three main functionalities should be verified on the board:

\begin{itemize}
	\item Schmitt-trigger circuitry and \texttt{AND} gate circuit
	\item PWM logic level shifting
	\item Motor driver circuit
\end{itemize}

The remaining functionalities has either been tested beforehand or deemed too simple to test. 

\par{Schmitt-trigger Circuitry and \texttt{AND} Gate Circuit}
The Schmitt-triggers were tested by varying the input voltage and verifying the switching threshold along with the the hysteresis levels. 
Testing the \texttt{AND} gate was done by applying different logic levels and verifying the results.
The complete circuit was found to work as intended.

\par{PWM Logic Level Shifting}
The functionality of the logic level shifter \texttt{74LVC2G17} was verified by measuring input and output on an oscilloscope. 

\par{Motor Driver Circuit}
Because of a design error on the developed PCB the motor driver circuit on the PCB could not be tested. 
Therefore it was decided to develop a small test PCB with the sole purpose of testing the motor driver circuit.
The circuit can bee seen in \ref{}.......
\mikkel{Make correct reference}.
A picture of the developed PCB is shown in figure \ref{fig:m_drive_circuit}.

\begin{figure}
	\centering
	\includegraphics[width=0.5\linewidth]{graphics/hipboard_pic}
	\caption[PCB developed to test functionality of motor driver.]{Picture of PCB developed to test the functionality of the motor drive circuitry.}
	\label{fig:m_drive_circuit}
\end{figure}
The boards gate signals was wired to the gate of four MOSFETs.
A power resistiro was used as a load and PWM signals was applied to the motor driver input pins. 
Measuring the gate signals showed strange behaviour and after a thorough inspection of the board and the schematic it was found that the bootstrap diode was facing the wrong direction. 
The source of this was an error in the footprint of the component. 
After correcting the issue the driver and the bootstrap circuit was found to function as intended. 
The measured signals are shown in figure \ref{fig:test_hip_signals}.

\begin{figure}[h]
	\centering
    \input{graphics/test_motor_drive_signals.tex}
	\caption[Measured gate and input signals.]{Measured low and high side gate signals along with low side motor driver input signals.}
	\label{fig:test_hip_signals}
\end{figure}
It is verified that the low side gate signal follows the waveform of low side input signal, but with a logic level of $\approx$12V as expected. 
It is also verified that the high side gate signals are 180$^\circ$ out of phase of the low side signals and are correctly bootstrapped to $\approx$24V.

